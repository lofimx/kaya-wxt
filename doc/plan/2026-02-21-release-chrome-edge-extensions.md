# Release Extensions to Chrome Web Store, Edge Add-ons, and Firefox AMO

**Date:** 2026-02-21
**Type:** Feature / DevOps

## Goal

1. Generate store listing assets (icons, promo images, listing text) and check them into `doc/stores/`
2. Document the full release process in `doc/stores/STORES.md`
3. Perform the first manual submission to Chrome Web Store and Edge Add-ons
4. Add automated publishing to the GitHub Actions release workflow for all three stores (Chrome, Edge, Firefox)

## Background

Chrome and Edge both require an initial manual submission before API-based automation is possible:

- **Chrome Web Store**: First upload via the [Developer Dashboard](https://chrome.google.com/webstore/devconsole) to obtain an extension ID, complete store listing, and pass review. Subsequent updates use the [Chrome Web Store API](https://developer.chrome.com/docs/webstore/using-api).
- **Edge Add-ons**: First upload via [Partner Center](https://partner.microsoft.com/dashboard/microsoftedge/) to obtain a product ID, complete listing, and pass review. Subsequent updates use the [Edge Add-ons REST API v1.1](https://learn.microsoft.com/en-us/microsoft-edge/extensions/update/api/using-addons-api).
- **Firefox AMO**: The initial release has already been performed manually. Automated updates use `web-ext sign` with [AMO JWT API credentials](https://addons.mozilla.org/en-US/developers/addon/api/key/).

## Prerequisites

1. A Google account with 2-step verification enabled
2. A [Chrome Web Store developer account](https://chrome.google.com/webstore/devconsole) ($5 one-time registration fee)
3. A [Microsoft Partner Center account](https://partner.microsoft.com/dashboard/microsoftedge/) (free)
4. [Firefox AMO API credentials](https://addons.mozilla.org/en-US/developers/addon/api/key/) (already have from initial Firefox release)

---

## Phase 1: Generate Store Listing Assets

Create `bin/generate-store-assets.sh` to generate icons and promo images for all three stores, saving output to `doc/stores/`.

### 1a. Script: `bin/generate-store-assets.sh`

The script generates from `doc/design/yellow-floppy4.svg`:

| Asset | Dimensions | Purpose |
|---|---|---|
| `store-icon-128.png` | 128x128 | Chrome Web Store icon, Firefox AMO icon |
| `store-icon-300.png` | 300x300 | Edge Add-ons icon |
| `promo-small-440x280.png` | 440x280 | Chrome small promo tile (optional) |

All are generated by rendering the SVG at the target size with `rsvg-convert`, centered on a white (or transparent) background where the aspect ratio doesn't match.

**Dependencies:** `rsvg-convert` (from `librsvg2-bin`), ImageMagick `convert`.

### 1b. Screenshots (Manual)

Screenshots cannot be scripted because they require a running browser with the extension loaded. Instead, leave instructions in `doc/stores/STORES.md`:

1. Load the extension in Chrome/Edge/Firefox via developer mode
2. Navigate to any website
3. Click the toolbar button to show the popup
4. Capture a 1280x800 screenshot of the browser window
5. Save to `doc/stores/screenshot-1-popup.png`
6. Optionally capture additional screenshots (context menu, options page)
7. Save as `doc/stores/screenshot-2-*.png`, etc.

All three stores accept 1280x800 screenshots. This is the recommended size for Chrome (up to 5), Edge (up to 10), and Firefox (unlimited, 1.6:1 ratio recommended).

### 1c. Listing Text

Write `doc/stores/listing.md` with:

- **Short description** (up to 132 chars): reuse from `wxt.config.ts`
- **Long description**: explain what Save Button does, that it syncs via a local native host, and that data goes to the user's own server
- **Privacy policy summary**: no third-party analytics, no tracking, data goes only to the user's configured server
- **Category**: Productivity
- **Website**: `https://savebutton.com`

---

## Phase 2: Manual First Submission -- Chrome Web Store

### 2a. Register and Set Up Developer Account

1. Go to [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole)
2. Pay the $5 registration fee if not already registered
3. Complete identity verification if prompted

### 2b. Create Google Cloud OAuth Credentials

These credentials are needed for automated publishing later.

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project (e.g. "Save Button CWS")
3. Enable the **Chrome Web Store API** for the project
4. Configure the **OAuth consent screen** (External, add the `https://www.googleapis.com/auth/chromewebstore` scope)
5. Create an **OAuth 2.0 Client ID** (type: Desktop app)
6. Note the **Client ID** and **Client Secret**
7. Generate a **Refresh Token**:
   - Visit: `https://accounts.google.com/o/oauth2/auth?response_type=code&scope=https://www.googleapis.com/auth/chromewebstore&client_id=YOUR_CLIENT_ID&redirect_uri=urn:ietf:wg:oauth:2.0:oob`
   - Authorize and copy the authorization code
   - Exchange for refresh token:
     ```
     curl -X POST "https://oauth2.googleapis.com/token" \
       -d "client_id=YOUR_CLIENT_ID" \
       -d "client_secret=YOUR_CLIENT_SECRET" \
       -d "code=YOUR_AUTH_CODE" \
       -d "grant_type=authorization_code" \
       -d "redirect_uri=urn:ietf:wg:oauth:2.0:oob"
     ```
   - Note the **Refresh Token** from the response

### 2c. Upload Initial Extension

1. Build the Chrome zip: `cd extension && pnpm zip:chrome`
2. In the Developer Dashboard, click "New item"
3. Upload the zip from `extension/.output/` (filename pattern: `save-button-<version>-chrome.zip`)
4. Fill in the Store Listing tab using text from `doc/stores/listing.md`, screenshots from `doc/stores/`, and icon from `doc/stores/store-icon-128.png`
5. Category: "Productivity", Language: English
6. Fill in the Privacy tab (privacy policy URL, permissions justification -- `nativeMessaging` is for communication with a local native host for file sync)
7. Submit for review
8. **Note the Chrome Extension ID** from the dashboard URL (32-character lowercase string)

### 2d. Record the Extension ID

Update the placeholder in `nativehost/src/main.rs`:

```rust
const CHROME_ORIGIN_PLACEHOLDER: &str = "chrome-extension://ACTUAL_EXTENSION_ID/";
```

Check off the README.md TODO for Chrome Extension ID.

---

## Phase 3: Manual First Submission -- Edge Add-ons

### 3a. Register Developer Account

1. Go to [Microsoft Partner Center](https://partner.microsoft.com/dashboard/microsoftedge/)
2. Sign in with a Microsoft account and complete registration (free)

### 3b. Upload Initial Extension

1. Build the Edge zip: `cd extension && pnpm zip:edge`
2. In Partner Center, click "Create new extension"
3. Upload the zip from `extension/.output/` (filename pattern: `save-button-<version>-edge.zip`)
4. Fill in the store listing using text from `doc/stores/listing.md`, screenshots from `doc/stores/`, and icon from `doc/stores/store-icon-300.png`
5. Submit for review
6. **Note the Product ID** from the URL or extension details page

### 3c. Generate API Credentials

1. In Partner Center, navigate to **Publish API** under the Microsoft Edge program
2. Click "Enable" next to "enable the new experience" to switch to the v1.1 UI
3. Click **Create API credentials**
4. Note the **Client ID** and **API Key**

### 3d. Record the Extension ID

Update `nativehost/src/main.rs` to add the Edge extension's `allowed_origins`. Edge uses the same `chrome-extension://` scheme as Chrome but with a different ID. Add a second origin constant or expand the existing one.

Check off the README.md TODO for Edge Extension ID.

---

## Phase 4: Configure GitHub Repository Secrets

Add the following secrets to the GitHub repository (Settings > Secrets and variables > Actions):

### Chrome Web Store

| Secret Name | Value |
|---|---|
| `CHROME_EXTENSION_ID` | 32-char extension ID from Phase 2c |
| `CHROME_CLIENT_ID` | Google OAuth Client ID from Phase 2b |
| `CHROME_CLIENT_SECRET` | Google OAuth Client Secret from Phase 2b |
| `CHROME_REFRESH_TOKEN` | Google OAuth Refresh Token from Phase 2b |

### Edge Add-ons

| Secret Name | Value |
|---|---|
| `EDGE_PRODUCT_ID` | Product ID from Phase 3b |
| `EDGE_CLIENT_ID` | Partner Center Client ID from Phase 3c |
| `EDGE_API_KEY` | Partner Center API Key from Phase 3c |

### Firefox AMO

| Secret Name | Value |
|---|---|
| `AMO_JWT_ISSUER` | JWT issuer key from [AMO API keys page](https://addons.mozilla.org/en-US/developers/addon/api/key/) (looks like `user:12345:67`) |
| `AMO_JWT_SECRET` | JWT secret from the same page (64-char hex string) |

---

## Phase 5: Update GitHub Actions Workflow

Add three new publish jobs to `.github/workflows/release.yml`.

### 5a. Chrome Web Store Publish Job

```yaml
publish-chrome:
  name: Publish to Chrome Web Store
  needs: [build-extension, test-rust, test-extension]
  runs-on: ubuntu-latest
  steps:
    - name: Download Chrome extension
      uses: actions/download-artifact@v4
      with:
        name: extension-chrome
        path: artifacts

    - name: Publish to Chrome Web Store
      uses: mnao305/chrome-extension-upload@v5
      with:
        file-path: artifacts/*.zip
        extension-id: ${{ secrets.CHROME_EXTENSION_ID }}
        client-id: ${{ secrets.CHROME_CLIENT_ID }}
        client-secret: ${{ secrets.CHROME_CLIENT_SECRET }}
        refresh-token: ${{ secrets.CHROME_REFRESH_TOKEN }}
```

### 5b. Edge Add-ons Publish Job

```yaml
publish-edge:
  name: Publish to Edge Add-ons
  needs: [build-extension, test-rust, test-extension]
  runs-on: ubuntu-latest
  steps:
    - name: Download Edge extension
      uses: actions/download-artifact@v4
      with:
        name: extension-edge
        path: artifacts

    - name: Find zip file
      id: find-zip
      run: echo "zip_path=$(ls artifacts/*.zip)" >> "$GITHUB_OUTPUT"

    - name: Publish to Edge Add-ons
      uses: wdzeng/edge-addon@v2
      with:
        product-id: ${{ secrets.EDGE_PRODUCT_ID }}
        zip-path: ${{ steps.find-zip.outputs.zip_path }}
        client-id: ${{ secrets.EDGE_CLIENT_ID }}
        api-key: ${{ secrets.EDGE_API_KEY }}
```

### 5c. Firefox AMO Publish Job

```yaml
publish-firefox:
  name: Publish to Firefox AMO
  needs: [build-extension, test-rust, test-extension]
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4

    - uses: pnpm/action-setup@v4
      with:
        version: latest

    - uses: actions/setup-node@v4
      with:
        node-version: 24
        cache: pnpm
        cache-dependency-path: extension/pnpm-lock.yaml

    - name: Install dependencies
      working-directory: extension
      run: pnpm install

    - name: Download Firefox extension
      uses: actions/download-artifact@v4
      with:
        name: extension-firefox
        path: artifacts

    - name: Sign and publish to AMO
      working-directory: extension
      run: pnpm wxt submit --browser firefox
      env:
        WEB_EXT_API_KEY: ${{ secrets.AMO_JWT_ISSUER }}
        WEB_EXT_API_SECRET: ${{ secrets.AMO_JWT_SECRET }}
```

Note: WXT wraps `web-ext sign` via `wxt submit`. If `wxt submit` doesn't work for listed extensions, fall back to using `web-ext sign` directly or the `kewisch/action-web-ext` GitHub Action.

### 5d. Update Release Job Dependencies

```yaml
release:
  needs: [build-extension, build-nativehost, package-linux, publish-chrome, publish-edge, publish-firefox]
```

---

## Phase 6: Update `nativehost/src/main.rs` with Real Extension IDs

Once Chrome and Edge stores assign extension IDs:

1. Replace `CHROME_ORIGIN_PLACEHOLDER` with the actual Chrome origin: `chrome-extension://REAL_ID/`
2. Add the Edge origin if it differs from Chrome
3. The `do_install()` function passes these to `native_messaging::install()` as `allowed_origins`

---

## Phase 7: Write Documentation

### 7a. `doc/stores/STORES.md`

Document the full release process for all three stores:

- Where build artifacts come from (GitHub Actions `build-extension` job, or local `pnpm zip:<browser>`)
- What GitHub secrets are required and how to regenerate them
- How to do the initial manual submission for a new store
- How to capture and update screenshots
- How automated releases work (tag triggers workflow, publish jobs submit to stores)

### 7b. `README.md`

Add a "Release" section explaining:

- Run `ruby bin/release.rb` to bump version, tag, and push
- The tag triggers the GitHub Actions workflow which builds and publishes to all stores
- Link to `doc/stores/STORES.md` for detailed store setup instructions

---

## Phase 8: Verify End-to-End

1. Create a test release (e.g. `v0.1.1`) by running `ruby bin/release.rb`
2. Watch the GitHub Actions workflow
3. Confirm all three publish jobs succeed (Chrome, Edge, Firefox)
4. Verify stores show the updated version (may take minutes to days for review)

---

## Notes

- All three stores impose review periods. Automated submission does not mean instant availability.
- The `publish: true` default on `mnao305/chrome-extension-upload` submits for review immediately after upload. Set `publish: false` if you want to review the listing in the dashboard first.
- Firefox AMO may not fully support automated listed signing -- the extension gets submitted for review rather than auto-published. This is fine; the automation still removes manual upload steps.
- Store reviews may reject extensions that request unnecessary permissions. The `nativeMessaging` permission justification should explain that Save Button communicates with a local native host for file sync.

---

## References

- [Chrome Web Store API docs](https://developer.chrome.com/docs/webstore/using-api)
- [Chrome Web Store image requirements](https://developer.chrome.com/docs/webstore/images/)
- [mnao305/chrome-extension-upload](https://github.com/mnao305/chrome-extension-upload) -- GitHub Action
- [Edge Add-ons REST API v1.1](https://learn.microsoft.com/en-us/microsoft-edge/extensions/update/api/using-addons-api)
- [wdzeng/edge-addon](https://github.com/wdzeng/edge-addon) -- GitHub Action
- [Edge developer registration](https://learn.microsoft.com/en-us/microsoft-edge/extensions/publish/create-dev-account)
- [Firefox Extension Workshop: submitting an add-on](https://extensionworkshop.com/documentation/publish/submitting-an-add-on/)
- [Firefox AMO API keys](https://addons.mozilla.org/en-US/developers/addon/api/key/)
- [kewisch/action-web-ext](https://github.com/marketplace/actions/web-ext-action-for-firefox-add-ons) -- GitHub Action (alternative for AMO)
